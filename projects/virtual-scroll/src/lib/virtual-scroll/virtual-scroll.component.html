<div
    #headerContainer
    *ngIf="showHeader"
    class="header-container"
    [style.width]="'calc(100% - ' + ((hasVerticalScrollBar$ | async) ? 16 : 0) + 'px)'"
    (scroll)="onScroll.next($event)">
    <ng-container
        headerOutlet
        [rowTemplate]="headerTemplate"
        [defaultRowTemplate]="defaultHeaderTemplate"
        [cellPadding]="cellPadding"
        [mappedActiveColumns$]="mappedActiveColumns$"
        [moveItem]="moveItem"
        [applyStickyShadow]="applyStickyShadow$"
        [headerCellDefs]="headerCellDefs?.toArray() ?? []"
        [defaultHeaderCellTemplate]="defaultHeaderCellTemplate">
    </ng-container>
</div>

<ng-container *ngIf="loading$ | async; else emptyStateTemplate">
    <div>Loading...</div>
</ng-container>

<ng-template #emptyStateTemplate>
    <ng-container *ngIf="!(dataSource$ | async)?.length; else listTemplate">
        <div>No data to display!</div>
    </ng-container>
</ng-template>

<ng-template #listTemplate>
    <cdk-virtual-scroll-viewport
        #virtualScroll
        [itemSize]="itemSize$ | async"
        [style.height.px]="tableHeight$ | async"
        [minBufferPx]="minBuffer$ | async"
        [maxBufferPx]="maxBuffer$ | async"
        (window:resize)="resizeEvent.next(virtualScroll.elementRef.nativeElement)"
        (scrolledIndexChange)="scrollIndex.next($event)"
        (scroll)="onScroll.next($event)">
        
        <ng-container
            *cdkVirtualFor="
                let item of dataSource$ | async;
                let index = index;
                templateCacheSize: 0;
                trackBy: trackByFn;"
            rowOutlet
            [rowTemplate]="rowTemplate"
            [defaultRowTemplate]="defaultRowTemplate"
            [cellPadding]="cellPadding"
            [mappedActiveColumns$]="mappedActiveColumns$"
            [moveItem]="moveItem"
            [item]="item"
            [index]="index"
            [applyStickyShadow]="applyStickyShadow$">
        </ng-container>

    </cdk-virtual-scroll-viewport>
</ng-template>

<div *ngIf="showFooter" style="height: 40px; display: flex; align-items: center; justify-content: flex-end; padding: 0px 16px; border-top: 2px solid #F0F0F0;">
    <div *ngIf="footerData$ | async as footerData">
        {{footerData.start + 1 | number}} to {{footerData.end + 1 | number}} of <b>{{footerData.itemCount | number}}</b>
    </div>
</div>

<ng-template #defaultHeaderTemplate let-item>
    <div vs-row class="vs-default-header-row">
    </div>
</ng-template>

<ng-template #defaultRowTemplate>
    <div vs-row class="vs-default-row">
    </div>
</ng-template>

<ng-template #defaultHeaderCellTemplate let-columnName="columnName">
    <div class="vs-default-header-cell">
        {{ columnName }}
    </div>
</ng-template>